# 什么是AE

AE（Auto Exposure）是自动曝光（调节）的意思。是相机根据外界光线的强弱自动调整曝光量和增益，防止曝光过度或者不足的一种机制。</br>
如果我是一束光，在穿过了Lens后，就要达到感光Sensor上了。那么AE就是就是用来控制有多少光可以抵达Sendor的一种机制。

## 曝光

曝光（英语：Exposure）是指摄影的过程中允许进入镜头照在感光媒体（胶片相机的底片或是数字照相机的图像传感器）上的光量。</br>
要说起精确的曝光定义，1960年的时候美国标准机构ASA就提出了APEX(Additive System of Photographic Exposure)，为了方便计算胶片机的曝光参数，提出的一个经验公式，也称为曝光方程。

<img src="https://github.com/lowkeyway/Embedded/blob/master/Software/Driver/Pic/Camera/Camera%20%E6%9B%9D%E5%85%89%E6%96%B9%E7%A8%8B.png">

+ **Av**表示光圈大小，其值每增1加个单位，表示进光量减少一半。
+ **Tv**表示快门快慢，其值每增1加个单位，表示进光量减少一半。
+ **Sv**表示相机感度，其值每增1加个单位，表示相机对同样进光量的敏感度增加一倍，体现在照片上就是亮度增加一倍。
+ **Bv**表示环境光的平均亮度，其每增加1个单位，表示环境光平均亮度增加一倍。

从直观上理解曝光公式：当等式右边增加时，表示相机敏感度或环境光增加，为了保持照片同样亮度，需要减少进光量，即减少等式左边的和。同理，当相机敏感度或环境光减少时，需要增加进光量，即增加左边的和。因此，在测出环境光亮度Bv时，根据公式可以计算出合适的曝光参数**光圈、快门、ISO组合**（当然这里有很多组合可以满足等式，至于如何选择有专门的算法和图表可查）

### 曝光的标准

既然曝光意指通光量的大小，那么多少的同光量算是一个正常标准呢？</br>
我们知道物体的亮度与色彩是由物体对光线的反射率来决定的。例如纯黑色的放射率是0，纯白色的反射率是100%，处于中间的灰度的反射率是18%，这就是18%中间灰度。

<img src="https://github.com/lowkeyway/Embedded/blob/master/Software/Driver/Pic/Camera/Camera%20%E8%87%AA%E5%8A%A8%E6%9B%9D%E5%85%89%E7%9A%84%E6%A0%87%E5%87%86.jpg">

具有一定反射率的物体在最终的图像中被还原到了其相应的灰度级，这就意味着达到了正确的曝光。例如摄影师们通常在拍摄之前使用中性灰卡测试曝光是否正常。

有标准，那么就肯定有偏大和偏小之说。简单的说
+ 过曝就是通光量太大了，导致画面中亮度太高照片泛白；
+ 相反，欠曝就是通光量太小了，导致画面亮度太低照片暗淡；

找个对比图就看得明白：

<img src="https://github.com/lowkeyway/Embedded/blob/master/Software/Driver/Pic/Camera/Camera%20%E6%9B%9D%E5%85%89%E6%AD%A3%E5%B8%B8%E3%80%81%E8%BF%87%E6%9B%9D%E3%80%81%E4%B8%8D%E8%B6%B3%E7%9A%84%E5%AF%B9%E6%AF%94.png">




## 曝光和直方图

从另外一个角度做曝光的定量分析，我想起来从直方图片。直方图分析图片中每个像素的亮度值，并且做统计，可以参考雷神的图：

<img src="https://github.com/lowkeyway/Embedded/blob/master/Software/Driver/Pic/Camera/Camera%20%E8%BF%87%E6%9B%9D%E5%92%8C%E6%9B%9D%E5%85%89%E4%B8%8D%E8%B6%B3%E4%B8%8B%E7%9A%84%E7%9B%B4%E6%96%B9%E5%9B%BE.png">

+ 过曝的图，直方图亮度趋于集中数值大的一端；
+ 曝光不足的图，直方图的亮度统计趋于集中数值较小的一端；

PS： 雷神说可以用直方图均衡的方法做后期处理，可AE现在要做的是在前端就把把这种现象扼杀在摇篮中。

## 自动曝光

那么问题来了，一般来说是什么因素导致了这种过曝和欠曝的现象呢？我们又改如何解决呢？
1. “曝光”可以经由光圈，快门和感光媒体的感光度的组合来控制。所以肯定是这三者某一个或者某些因素配合出了问题。
2. 如何解决？AE自动曝光就通过调节这三者之间的关系来解决这个问题的。

自动曝光其实就是一个根据实际图片做反馈来调节到目标亮度的过程。

<img src="https://github.com/lowkeyway/Embedded/blob/master/Software/Driver/Pic/Camera/Camera%20%E8%87%AA%E5%8A%A8%E6%9B%9D%E5%85%89%E6%B5%81%E7%A8%8B.png">

# 支持AE的几个硬件要素

## 光圈（Aperture）

光圈（英语：Aperture）：
+ 硬件：是照相机上用来控制镜头孔径大小的部件，以控制景深、镜头成像素质、以及和快门协同控制进光量。对于已经制造好的镜头，不能随意改变镜头的直径，但是可以通过在镜头内部加入多边形或者圆型，并且面积可变的孔状光栅来达到控制镜头通光量，这个装置就叫做光圈，

<img src="https://github.com/lowkeyway/Embedded/blob/master/Software/Driver/Pic/Camera/Camera%2004-AE%20%E5%85%89%E5%9C%88.jpg">

+ 抽象：也可以用来表示光圈值。光学系统中的焦比（英语：f-number，或称F值、F比例、相对孔径、光圈值等，习惯上也简称“光圈”）表达镜头的焦距和光圈直径大小的关系。即公式：

ƒ/"#=N=f/D</br>
**光圈值=镜头的焦距/光圈口径**。
上式中，ƒ 是焦距，而 D 是光圈直径。

特性：**光圈值越小光圈就越大，进光量也越大，景深越浅**。意即D值(光圈有效孔径)越大，N值(光圈值)越小。

### 光圈大小的表示

#### f表示法
我们最常见的光圈大小表示应该是这个样子的， f/# 或直接写成f #:

<img src="https://github.com/lowkeyway/Embedded/blob/master/Software/Driver/Pic/Camera/Camera%2004-AE%20%E5%85%89%E5%9C%88f%E5%80%BC%E8%A1%A8%E7%A4%BA%E6%B3%95.jpg">

书写时数值替代符号中的#，即#就代表了焦距和光圈直径大小的比值（而不是光圈直径D了，变成了表示比值N），这里的f可以不理解成公式中的焦距，/可以不用理解成公式中的除号。
举个例子，若焦距值是光圈直径的16倍，那样 ƒ 值是 ƒ/16，或 N = 16。

#### f表示法的等级划分

看多了f表示法，就会看到各种各样的值：
<img src="https://github.com/lowkeyway/Embedded/blob/master/Software/Driver/Pic/Camera/Camera%2004-AE%20%E5%85%89%E5%9C%88f%E5%80%BC%E8%A1%A8%E7%A4%BA%E6%B3%95%E5%88%86%E7%BA%A7.jpg">


### 光圈和进光量

光圈系数= 镜头焦距/光圈孔径；常用的镜头的光圈数序列为

1， 1.4， 2， 2.8， 4， 5.6， 8， 11， 16， 22， 32， 45， 64，90，128

通过镜头到达感光底片或芯片的光的照度和光圈孔径的平方成正比，和光圈数的平方成反比。光圈数序列中相邻两个光圈数的平方比为 1：2，因此，光圈环转动一格，照度相差一倍：

2x 1.42 =22
2x5.62 = 82
2x82=112

这个很好理解，在曝光时间固定的情况下，光圈越大（f值越小）进光量越大嘛：

<img src="https://github.com/lowkeyway/Embedded/blob/master/Software/Driver/Pic/Camera/Camera%2004-AE%20%E5%85%89%E5%9C%88%E5%92%8C%E8%BF%9B%E5%85%89%E9%87%8F.jpg">

### 光圈和景深

要理解光圈和景深的关系，就要回到小孔成像的原理。
我们知道，照相机设计得在复杂，其根本也是小孔成像，而不是大孔成像。因为一旦孔开得大了，得到的图像势必会变得模糊，除非待测物体很大（即待测物体跟小孔的直径的比值保持比例关系）




## 快门（Shutter）

## 感光度（ISO）


# 支持AE的软件算法


